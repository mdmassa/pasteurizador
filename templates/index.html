<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Pasteurizador</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        :root {
            --cor-primaria: #0071bc;
            --cor-aquecedor: #ff5459;
            --cor-refrigerador: #3498db;
            --cor-fundo: #e8e8e8;
            --cor-texto: #333;
            --cor-texto-secundario: #999;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: var(--cor-fundo);
            margin: 0;
            padding: 0;
            color: var(--cor-texto);
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: var(--cor-fundo);
            min-height: 100vh;
        }
        
        header {
            background: var(--cor-primaria);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        .menu-icon {
            font-size: 1.8rem;
            cursor: pointer;
        }
        
        /* Seção Informações Gerais */
        .info-section {
            padding: 25px 20px;
        }
        
        .info-section h2 {
            color: var(--cor-primaria);
            font-size: 1.6rem;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .aviso-container {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            font-size: 1rem;
            color: var(--cor-texto-secundario);
        }
        
        .aviso-container label {
            margin-right: 15px;
            font-weight: 500;
        }
        
        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: var(--cor-primaria);
            border-radius: 30px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: white;
            top: 2px;
            right: 2px;
            transition: transform 0.3s;
        }
        
        .toggle-switch.off {
            background: #ccc;
        }
        
        .toggle-switch.off::after {
            transform: translateX(-30px);
        }
        
        /* Timer Circular */
        .timer-container {
            display: flex;
            justify-content: center;
            margin: 40px 0;
        }
        
        .circular-timer {
            position: relative;
            width: 280px;
            height: 280px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .timer-circle {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        
        .timer-circle circle {
            fill: none;
            stroke-width: 10;
        }
        
        .timer-bg {
            stroke: #d0d0d0;
        }
        
        .timer-progress {
            stroke: var(--cor-aquecedor);
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dashoffset 0.5s;
        }
        
        .timer-content {
            text-align: center;
            z-index: 1;
        }
        
        .timer-value {
            font-size: 4rem;
            font-weight: 300;
            color: var(--cor-texto);
            line-height: 1;
        }
        
        .timer-label {
            font-size: 1rem;
            color: var(--cor-texto-secundario);
            margin-top: 8px;
        }
        
        /* Ícones de Controle */
        .controle-icons {
            display: flex;
            justify-content: space-around;
            max-width: 450px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .icon-item {
            text-align: center;
        }
        
        .icon-circle {
            width: 60px;
            height: 60px;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
        }
        
        .icon-item span {
            display: block;
            font-size: 1rem;
            color: var(--cor-texto);
            font-weight: 500;
        }
        
        /* Card de Temperatura */
        .temperatura-card {
            background: white;
            border-radius: 15px;
            padding: 30px 20px;
            margin: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .temperatura-card h3 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.4rem;
            color: var(--cor-texto);
            font-weight: 600;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 15px;
        }
        
        .temp-valores {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        
        .temp-item {
            text-align: center;
        }
        
        .temp-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
        }
        
        .temp-icon.quente {
            color: var(--cor-aquecedor);
        }
        
        .temp-icon.frio {
            color: var(--cor-refrigerador);
        }
        
        .temp-value {
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--cor-texto);
        }
        
        .temp-unit {
            font-size: 1.8rem;
            font-weight: 400;
            color: var(--cor-texto-secundario);
        }
        
        /* Seção Controles */
        .controle-container {
            padding: 25px 20px;
            background: var(--cor-fundo);
        }
        
        .controle-title {
            color: var(--cor-primaria);
            font-size: 1.6rem;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .botoes-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .btn-controle {
            background: white;
            border: 2px solid var(--cor-primaria);
            border-radius: 12px;
            padding: 18px 20px;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--cor-primaria);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .btn-controle:hover {
            background: var(--cor-primaria);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 113, 188, 0.3);
        }
        
        .btn-controle i {
            font-size: 1.3rem;
        }
        
        /* Ocultar elementos antigos mas manter dados */
        .status-container {
            display: none;
        }
        
        /* Media queries para responsividade */
        @media (max-width: 768px) {
            header {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .circular-timer {
                width: 250px;
                height: 250px;
            }
            
            .timer-value {
                font-size: 3.5rem;
            }
            
            .temperatura-card {
                margin: 20px 15px;
            }
            
            .temp-icon {
                font-size: 3rem;
            }
            
            .temp-value {
                font-size: 3rem;
            }
            
            .botoes-container {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 400px) {
            .timer-value {
                font-size: 3rem;
            }
            
            .temp-value {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Dashboard</h1>
            <div class="menu-icon">
                <i class="fas fa-bars"></i>
            </div>
        </header>
        
        <!-- Mantém os sensores ocultos para o JavaScript funcionar -->
        <div class="status-container">
            <div class="sensor-card">
                <div class="sensor-title">Aquecedor A</div>
                <div class="sensor-value auecedor" id="temp-a">{{ status.temperaturas.a }} °C</div>
            </div>
            
            <div class="sensor-card">
                <div class="sensor-title">Aquecedor B</div>
                <div class="sensor-value auecedor" id="temp-b">{{ status.temperaturas.b }} °C</div>
            </div>
            
            <div class="sensor-card">
                <div class="sensor-title">Refrigerador</div>
                <div class="sensor-value refrigerador" id="temp-r">{{ status.temperaturas.r }} °C</div>
            </div>
            
            <div class="sensor-card">
                <div class="sensor-title">Temperatura Média</div>
                <div class="sensor-value auecedor" id="temp-media">{{ status.temperaturas.media }} °C</div>
            </div>
        </div>
        
        <div class="info-section">
            <h2>Informações gerais</h2>
            
            <div class="aviso-container">
                <label>Aviso sonoro:</label>
                <div class="toggle-switch" id="toggleSwitch" onclick="toggleSound()"></div>
            </div>
            
            <div class="timer-container">
                <div class="circular-timer">
                    <svg class="timer-circle" viewBox="0 0 100 100">
                        <circle class="timer-bg" cx="50" cy="50" r="45"></circle>
                        <circle class="timer-progress" cx="50" cy="50" r="45" 
                                stroke-dasharray="283" 
                                stroke-dashoffset="212" 
                                id="timerProgress"></circle>
                    </svg>
                    <div class="timer-content">
                        <div class="timer-value" id="timerDisplay">10:57</div>
                        <div class="timer-label">Tempo percorrido</div>
                    </div>
                </div>
            </div>
            
            <div class="controle-icons">
                <div class="icon-item">
                    <div class="icon-circle">
                        <i class="fas fa-fire" style="color: var(--cor-aquecedor);"></i>
                    </div>
                    <span>Aquecimento</span>
                </div>
                
                <div class="icon-item">
                    <div class="icon-circle">
                        <i class="fas fa-snowflake" style="color: var(--cor-refrigerador);"></i>
                    </div>
                    <span>Resfriamento</span>
                </div>
            </div>
        </div>
        
        <div class="temperatura-card">
            <h3>Temperatura</h3>
            <div class="temp-valores">
                <div class="temp-item">
                    <div class="temp-icon quente">
                        <i class="fas fa-flask"></i>
                    </div>
                    <div>
                        <span class="temp-value" id="display-temp-quente">68</span>
                        <span class="temp-unit">°C</span>
                    </div>
                </div>
                
                <div class="temp-item">
                    <div class="temp-icon frio">
                        <i class="fas fa-tint"></i>
                    </div>
                    <div>
                        <span class="temp-value" id="display-temp-frio">10</span>
                        <span class="temp-unit">°C</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="controle-container">
            <h2 class="controle-title">Controles</h2>
            <div class="botoes-container">
                <form action="/controle" method="post" style="display: contents;">
                    <input type="hidden" name="dispositivo" value="ebulidor">
                    <button type="submit" name="acao" value="parar" class="btn-controle">
                        <i class="fas fa-exclamation-circle"></i>
                        <span>FORÇAR PARADA</span>
                    </button>
                </form>
                
                <form action="/controle" method="post" style="display: contents;">
                    <input type="hidden" name="dispositivo" value="peltier">
                    <button type="submit" name="acao" value="limpeza" class="btn-controle">
                        <i class="fas fa-spray-can"></i>
                        <span>MODO LIMPEZA</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        let soundEnabled = true;
        let startTime = Date.now();
        
        // Toggle do aviso sonoro
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const toggle = document.getElementById('toggleSwitch');
            toggle.classList.toggle('off');
        }
        
        // Atualizar timer
        function updateTimer() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Atualizar progresso circular (exemplo: 25% de progresso)
            const progress = (elapsed % 60) / 60;
            const circumference = 283;
            const offset = circumference - (progress * circumference);
            document.getElementById('timerProgress').style.strokeDashoffset = offset;
        }
        
        setInterval(updateTimer, 1000);
        
        // Atualizar dados a cada 5 segundos
        setInterval(() => {
            fetch("/")
                .then(response => response.text())
                .then(data => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(data, "text/html");
                    
                    // Atualizar temperaturas nos elementos ocultos
                    document.querySelectorAll('.sensor-value').forEach((el, index) => {
                        const newValue = doc.querySelectorAll('.sensor-value')[index].textContent;
                        el.textContent = newValue;
                    });
                    
                    // Atualizar displays visíveis
                    const tempMedia = doc.getElementById('temp-media');
                    const tempR = doc.getElementById('temp-r');
                    
                    if (tempMedia) {
                        const valor = tempMedia.textContent.replace(/[^\d.]/g, '');
                        document.getElementById('display-temp-quente').textContent = Math.round(valor);
                    }
                    
                    if (tempR) {
                        const valor = tempR.textContent.replace(/[^\d.]/g, '');
                        document.getElementById('display-temp-frio').textContent = Math.round(valor);
                    }
                })
                .catch(err => console.error('Erro ao atualizar dados:', err));
        }, 5000);
    </script>
</body>
</html>